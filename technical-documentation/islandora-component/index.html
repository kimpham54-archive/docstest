<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Islandora component - Islandora CLAW</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Islandora CLAW</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Alpaca <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../alpaca/README/">README</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chullo <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../chullo/CONTRIBUTING/">CONTRIBUTING</a>
                        </li>
                    
                        <li >
                            <a href="../../chullo/README/">README</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Crayfish <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../crayfish/README/">README</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Install <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../install/README/">README</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Islandora <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../islandora/README/">README</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Migration <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../migration/fedora-namespace-predicates/">Fedora namespace predicates</a>
                        </li>
                    
                        <li >
                            <a href="../../migration/islandora-namespace-predicates/">Islandora namespace predicates</a>
                        </li>
                    
                        <li >
                            <a href="../../migration/migration/">Migration</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Pdx <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../pdx/README/">README</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../architecture/">Architecture</a>
                        </li>
                    
                        <li >
                            <a href="../commands/">Commands</a>
                        </li>
                    
                        <li >
                            <a href="../docs-build/">Docs build</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Islandora component</a>
                        </li>
                    
                        <li >
                            <a href="../islandora-middleware-services-api/">Islandora middleware services api</a>
                        </li>
                    
                        <li >
                            <a href="../services/">Services</a>
                        </li>
                    
                        <li >
                            <a href="../versioning/">Versioning</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../user-documentation/2xfor1x/">2xfor1x</a>
                        </li>
                    
                        <li >
                            <a href="../../user-documentation/adding-object-to-collection-in-islandora-7.x-2.x/">Adding object to collection in islandora 7.x 2.x</a>
                        </li>
                    
                        <li >
                            <a href="../../user-documentation/creating-collections-in-islandora-7.x-2.x/">Creating collections in islandora 7.x 2.x</a>
                        </li>
                    
                        <li >
                            <a href="../../user-documentation/editing-basic-image-form-in-islandora-7.x-2.x/">Editing basic image form in islandora 7.x 2.x</a>
                        </li>
                    
                        <li >
                            <a href="../../user-documentation/editing-object-metadata-in-islandora-7.x-2/">Editing object metadata in islandora 7.x 2</a>
                        </li>
                    
                        <li >
                            <a href="../../user-documentation/form-field-select-taxonomy-in-islandora-7.x-2.x/">Form field select taxonomy in islandora 7.x 2.x</a>
                        </li>
                    
                        <li >
                            <a href="../../user-documentation/intro-to-claw/">Intro to claw</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../docs-build/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../islandora-middleware-services-api/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/kimpham54/docstest">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#the-islandora-camel-component">The Islandora Camel Component</a></li>
        
            <li><a href="#introduction">Introduction</a></li>
        
            <li><a href="#configuration">Configuration</a></li>
        
            <li><a href="#usage">Usage</a></li>
        
            <li><a href="#errors-and-exceptions-in-php">Errors and Exceptions in PHP</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="the-islandora-camel-component">The Islandora Camel Component</h1>
<h2 id="introduction">Introduction</h2>
<p>From within a Camel route, if you ever want to execute a command you’ve writtin in PHP, all you need to do is use the Islandora Camel Component.  The Islandora Camel Component is a very small Camel component that mimics/wraps/extends bits of camel-exec in order to streamline the use of Camel commands.  It also is responsible for evaluating the exit status of the command and bubbling up an exceptions that may have been thrown.</p>
<h2 id="configuration">Configuration</h2>
<p>Before using the Islandora component, you need to configure it in the same Blueprint xml file that defines your Camel context.  Typically, this is the <code>src/main/resources/OSGI-INF/blueprint/blueprint.xml</code> for your particular Camel project.  The component accepts a single value: the absolute path to the <code>camel/commands/bin</code> directory of your project.  It is best to set this value in the <code>islandora.cfg</code> as <code>islandora.php.workingDir</code>.</p>
<p>Assuming you're using the <code>islandora.cfg</code> file deployed to your karaf's <code>etc</code> directory, your Blueprint file will look something like this:</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;blueprint xmlns=&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:cm=&quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&quot;
       xsi:schemaLocation=&quot;
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd&quot;&gt;

  &lt;!-- Load Configuration File --&gt;
  &lt;cm:property-placeholder persistent-id=&quot;islandora&quot;/&gt;

  &lt;!-- Islandora Component Configuration --&gt;
  &lt;bean id=&quot;islandora&quot; class=&quot;ca.islandora.camel.component.IslandoraComponent&quot;&gt;
    &lt;argument value=&quot;${islandora.php.workingDir}&quot;/&gt;
  &lt;/bean&gt;

  &lt;camelContext id=&quot;your_context_id&quot; xmlns=&quot;http://camel.apache.org/schema/blueprint&quot;&gt;
    &lt;-- Your routes go here... --&gt;
  &lt;/camelContext&gt;

&lt;/blueprint&gt;
</code></pre>

<h2 id="usage">Usage</h2>
<p>Once configured, you can use the component to execute any IslandoraCommand in PHP within your camel routes.  General usage is:</p>
<pre><code class="xml">&lt;to uri=&quot;islandora:namespace:command&quot;/&gt;
</code></pre>

<p>You can see a list of all available namespaces and commands at any time by going to the <code>camel/commands/bin</code> directory of your project and running <code>php islandora.php</code>.</p>
<pre><code class="bash">vagrant@islandora:~$ cd ~/islandora/camel/commands/bin
vagrant@islandora:~/islandora/camel/commands/bin$ php islandora.php
Islandora Command Tool version 0.0.0-SNAPSHOT

Usage:
  command [options] [arguments]

Options:
  -h, --help            Display this help message
  -q, --quiet           Do not output any message
  -V, --version         Display this application version
      --ansi            Force ANSI output
      --no-ansi         Disable ANSI output
  -n, --no-interaction  Do not ask any interactive question
  -v|vv|vvv, --verbose  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

Available commands:
  help                            Displays help for a command
  list                            Lists commands
 collectionService
  collectionService:nodeToSparql  Converts Drupal node JSON for a collection to a SPARQL Update query
 greeter
  greeter:hello                   Says hello!
  greeter:helloUsingJson          Says hello!  Accepts JSON data in the form {&quot;name&quot; : &quot;your_name&quot;}.
 rdf
  rdf:createNode                  Creates a Drupal node from Fedora RDF.
  rdf:extractContentType          Extracts a Drupal content type from Fedora RDF.
  rdf:updateNode                  Updates a Drupal node from Fedora RDF.
</code></pre>

<p>For example, to run the greeter example from the tutorial in the Commands documentation:</p>
<pre><code class="xml">&lt;to uri=&quot;islandora:greeter:hello&quot;/&gt;
</code></pre>

<p>Here's a small Blueprint file that will execute the <code>greeter:hello</code> command every 5 seconds and log the output.</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;blueprint xmlns=&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:cm=&quot;http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0&quot;
       xsi:schemaLocation=&quot;
       http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd&quot;&gt;

  &lt;!-- Load Configuration File --&gt;
  &lt;cm:property-placeholder persistent-id=&quot;islandora&quot;/&gt;

  &lt;!-- Islandora Component Configuration --&gt;
  &lt;bean id=&quot;islandora&quot; class=&quot;ca.islandora.camel.component.IslandoraComponent&quot;&gt;
    &lt;argument value=&quot;${islandora.php.workingDir}&quot;/&gt;
  &lt;/bean&gt;

  &lt;camelContext id=&quot;your_context_id&quot; xmlns=&quot;http://camel.apache.org/schema/blueprint&quot;&gt;
    &lt;route&gt;
      &lt;from uri=&quot;timer:foo?period=5000&quot;/&gt;
        &lt;setBody&gt;&lt;constant&gt;World&lt;/constant&gt;&lt;/setBody&gt;
        &lt;to uri=&quot;islandora:greeter:hello&quot;/&gt;
        &lt;log message=&quot;${body}&quot;/&gt;
    &lt;/route&gt;
  &lt;/camelContext&gt;

&lt;/blueprint&gt;
</code></pre>

<p>You can deploy this file to your karaf's <code>deploy</code> directory and watch it go.  In your logs, you should see something like this:</p>
<pre><code class="bash">vagrant@islandora:~$ /opt/karaf/bin/client
Logging in as karaf
750 [sshd-SshClient[6107227e]-nio2-thread-1] WARN org.apache.sshd.client.keyverifier.AcceptAllServerKeyVerifier - Server at [/0.0.0.0:8101, RSA, 88:ab:a4:c9:c0:bc:53:bf:bb:f8:b3:8b:80:98:26:7d] presented unverified {} key: {}
        __ __                  ____
       / //_/____ __________ _/ __/
      / ,&lt;  / __ `/ ___/ __ `/ /_
     / /| |/ /_/ / /  / /_/ / __/
    /_/ |_|\__,_/_/   \__,_/_/

  Apache Karaf (3.0.4)

Hit '&lt;tab&gt;' for a list of available commands
and '[cmd] --help' for help on a specific command.
Hit 'system:shutdown' to shutdown Karaf.
Hit '&lt;ctrl-d&gt;' or type 'logout' to disconnect shell from current session.

karaf@root()&gt; log:tail
2015-07-17 18:12:51,292 | INFO  | #7 - timer://foo | IslandoraProducer                | 132 - ca.islandora.camel.component.islandora-camel-component - 0.0.0.SNAPSHOT | Executing ExecCommand [args=[islandora.php, greeter:hello], executable=php, timeout=9223372036854775807, outFile=null, workingDir=/home/vagrant/islandora/camel/commands/bin, useStderrOnEmptyStdout=false]
2015-07-17 18:12:51,681 | INFO  | #7 - timer://foo | IslandoraProducer                | 132 - ca.islandora.camel.component.islandora-camel-component - 0.0.0.SNAPSHOT | The command ExecCommand [args=[islandora.php, greeter:hello], executable=php, timeout=9223372036854775807, outFile=null, workingDir=/home/vagrant/islandora/camel/commands/bin, useStderrOnEmptyStdout=false] had exit value 0
2015-07-17 18:12:51,682 | INFO  | #7 - timer://foo | route53                          | 109 - org.apache.camel.camel-core - 2.15.2 | Hello World!

2015-07-17 18:12:56,292 | INFO  | #7 - timer://foo | IslandoraProducer                | 132 - ca.islandora.camel.component.islandora-camel-component - 0.0.0.SNAPSHOT | Executing ExecCommand [args=[islandora.php, greeter:hello], executable=php, timeout=9223372036854775807, outFile=null, workingDir=/home/vagrant/islandora/camel/commands/bin, useStderrOnEmptyStdout=false]
2015-07-17 18:12:56,676 | INFO  | #7 - timer://foo | IslandoraProducer                | 132 - ca.islandora.camel.component.islandora-camel-component - 0.0.0.SNAPSHOT | The command ExecCommand [args=[islandora.php, greeter:hello], executable=php, timeout=9223372036854775807, outFile=null, workingDir=/home/vagrant/islandora/camel/commands/bin, useStderrOnEmptyStdout=false] had exit value 0
2015-07-17 18:12:56,676 | INFO  | #7 - timer://foo | route53                          | 109 - org.apache.camel.camel-core - 2.15.2 | Hello World!
</code></pre>

<h2 id="errors-and-exceptions-in-php">Errors and Exceptions in PHP</h2>
<p>The Islandora Camel component automatically handles checking the return code on the command, and will automatically bubble up any exception from PHP by throwing an IslandoraPHPException that can be handled within your Camel context.  See the section on exception handling in Camel for more information.</p></div>
        </div>

	<footer class="col-md-12">
		<hr>
		
		<p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
	</footer>


        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>